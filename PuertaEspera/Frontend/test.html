<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Monitor de Turnos (Admin)</title>
    <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; max-width: 800px; margin: 20px auto; background: #f4f4f9; }
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 20px; }
        input { padding: 8px; width: 60%; border: 1px solid #ddd; border-radius: 4px; }
        button { padding: 8px 15px; background: #2563eb; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #1d4ed8; }
        #logs { height: 300px; overflow-y: auto; background: #1e1e1e; color: #00ff00; padding: 15px; border-radius: 8px; font-family: monospace; }
        .log-item { margin-bottom: 5px; border-bottom: 1px solid #333; padding-bottom: 2px; }
        .error { color: #ff4444; }
        .success { color: #00ff00; font-weight: bold; }
        .info { color: #aaa; }
    </style>
</head>
<body>
    <h1>üì° Panel de Admin (WebSocket Tester)</h1>

    <div class="card">
        <h3>1. Configuraci√≥n</h3>
        <p>URL del Backend (Render):</p>
        <input type="text" id="backendUrl" value="https://TU-APP.onrender.com" placeholder="https://...">
        <br><br>
        <p>ID del Proyecto (UUID):</p>
        <input type="text" id="projectId" placeholder="Ej: 7a92328a-3300...">
        <br><br>
        <button onclick="conectar()">üîå Conectar y Unirse</button>
    </div>

    <div class="card">
        <h3>2. Monitor en Vivo</h3>
        <div id="logs">Esperando conexi√≥n...</div>
    </div>

    <script>
        let socket;
        const logsDiv = document.getElementById('logs');

        function log(msg, type = 'info') {
            const div = document.createElement('div');
            div.className = `log-item ${type}`;
            div.innerHTML = `[${new Date().toLocaleTimeString()}] ${msg}`;
            logsDiv.prepend(div);
        }

        function conectar() {
            const url = document.getElementById('backendUrl').value;
            const projectId = document.getElementById('projectId').value.trim(); // .trim() borra espacios invisibles!

            if (!url || !projectId) return alert("Faltan datos");

            if (socket) socket.disconnect(); // Desconectar si ya hab√≠a uno

            log(`Intentando conectar a ${url}...`, 'info');

            // Conexi√≥n
            socket = io(url);

            socket.on('connect', () => {
                log('‚úÖ Conectado al Servidor! ID Socket: ' + socket.id, 'success');
                
                // UNIRSE A LA SALA
                log(`Intentando unirse a sala: ${projectId}...`, 'info');
                socket.emit('unirse-proyecto', projectId);
            });

            socket.on('connect_error', (err) => {
                log(`‚ùå Error de conexi√≥n: ${err.message}`, 'error');
            });

            // ESCUCHAR TURNOS
            socket.on('nuevo-turno', (data) => {
                console.log("DATA RECIBIDA:", data);
                log(`üé´ <b>NUEVO TURNO RECIBIDO!</b><br>
                     Visitante: ${data.visitanteNombre}<br>
                     N√∫mero: #${data.numero}`, 'success');
            });

            socket.on('disconnect', () => {
                log('‚ö†Ô∏è Desconectado del servidor', 'error');
            });
        }
    </script>
</body>
</html>